MONITOR_SCRIPT = ./monitor.sh

.PHONY: monitor once check-prod help init

monitor:
	@echo "‚û°Ô∏è  Lancement du tableau de bord en continu..."
	@-ENV=$(ENV) $(MONITOR_SCRIPT) || true

once:
	@echo "‚û°Ô∏è  Ex√©cution unique du monitoring..."
	@REFRESH_INTERVAL=0 ENV=$(ENV) $(MONITOR_SCRIPT)

check-prod:
	@echo "‚û°Ô∏è  V√©rification directe de l'√©tat du Raspberry Pi..."
	@bash -c 'source lib/status.sh && \
	  echo "Docker     : $$(docker_status_prod)"; \
	  echo "Git hash   : $$(git_hash_prod)"; \
	  echo "Grist      : $$(grist_count_prod)"; \
	  echo "Ping       : $$(ping_pi)"; \
	  echo "Disque     : $$(disk_prod)"; \
	  echo "RAM        : $$(ram_prod)"; \
	  echo "CPU        : $$(cpu_prod)"'

help:
	@echo "\nüì¶  Commandes disponibles :\n"
	@echo "  make monitor ENV=both   - Lance la boucle de supervision (par d√©faut : both)"
	@echo "  make once ENV=dev       - Ex√©cute un seul cycle de test"
	@echo "  make check-prod         - V√©rifie uniquement l‚Äô√©tat du Raspberry Pi"
	@echo "  make init               - Rends les scripts ex√©cutables"
	@echo "  make help               - Affiche cette aide"
	@echo ""

init:
	@echo "‚û°Ô∏è  Initialisation des permissions..."
	@chmod +x monitor.sh lib/*.sh